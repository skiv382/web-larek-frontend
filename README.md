# Web-ларёк

Интернет-магазин для веб-разработчиков с современной архитектурой.

## Технологии

- **TypeScript** - типизированный JavaScript
- **Webpack** - сборка проекта
- **SCSS** - стилизация с методологией БЭМ
- **Event-Driven Architecture** - событийная архитектура
- **Command Pattern** - паттерн команд
- **State Management** - управление состоянием

## Установка и запуск

```bash
# Установка зависимостей
yarn install

# Запуск в режиме разработки
yarn start
```

Приложение будет доступно по адресу `http://localhost:8080`

## Архитектура

### Основные принципы

- **Событийная архитектура** - все взаимодействия через события
- **Команды** - каждое действие пользователя инкапсулировано в команду
- **Централизованное состояние** - единый источник истины
- **Реактивность** - автоматические обновления UI при изменении состояния
- **Валидация** - встроенная система проверки данных

### Структура проекта

```
src/
├── architecture/          # Архитектурные компоненты
│   ├── App.ts            # Главный класс приложения
│   ├── commands/         # Система команд
│   │   ├── user-commands/ # Команды пользователя (по одной на файл)
│   │   └── Command.ts    # Базовый класс команд
│   ├── events/           # Система событий
│   ├── state/            # Управление состоянием
│   └── validators/       # Система валидации
├── common.blocks/        # Блоки стилей (БЭМ)
├── images/              # Изображения
├── pages/               # HTML страницы
├── public/              # Публичные файлы
├── scss/                # Стили
└── vendor/              # Внешние библиотеки
```

### Ключевые компоненты

#### Application
Главный класс приложения, координирующий все компоненты:
- Инициализация и уничтожение приложения
- Управление UI обновлениями
- Обработка событий
- Подписка на изменения состояния

#### CommandManager
Управляет выполнением команд с поддержкой отмены и повтора операций:
- Выполнение команд
- История команд
- Отмена/повтор операций
- Ограничение размера истории

#### AppStore
Централизованное хранилище состояния с реактивными обновлениями:
- Реактивные обновления
- Подписка на изменения
- Иммутабельные обновления
- Селекторы для оптимизации

#### EventBus
Система событий с поддержкой middleware и приоритетов:
- Подписка на события
- Middleware обработка
- История событий
- Приоритеты обработчиков

#### ValidationEngine
Движок валидации с гибкими схемами проверки:
- Гибкие схемы валидации
- Цепочка правил
- Пользовательские валидаторы
- Валидация полей и форм

### Реализованные команды

- **AddToBasketCommand** - добавление товара в корзину
- **RemoveFromBasketCommand** - удаление товара из корзины
- **UpdateOrderFieldCommand** - обновление полей заказа
- **OpenModalCommand** - открытие модального окна
- **CloseModalCommand** - закрытие модального окна
- **LoadCatalogCommand** - загрузка каталога товаров
- **ClearBasketCommand** - очистка корзины

### Типы данных

- **ProductItem** - товар в каталоге
- **BasketItem** - товар в корзине
- **OrderState** - состояние заказа
- **ValidationState** - состояние валидации
- **ModalState** - состояние модальных окон

### Взаимодействие компонентов

1. **Пользовательское действие** → Создание команды
2. **Команда** → Валидация данных
3. **Валидация** → Обновление состояния
4. **Состояние** → Уведомление подписчиков
5. **Подписчики** → Обновление UI

## Функциональность

### Каталог товаров
- Загрузка товаров с сервера
- Отображение карточек товаров
- Предварительный просмотр товара
- Обработка товаров без цены

### Корзина
- Добавление/удаление товаров
- Подсчет общей стоимости
- Очистка корзины
- Счетчик товаров

### Оформление заказа
- Выбор способа оплаты
- Ввод адреса доставки
- Ввод контактных данных
- Валидация форм
- Отображение ошибок

### Модальные окна
- Предварительный просмотр товара
- Корзина
- Оформление заказа
- Контактные данные
- Успешное оформление

## Валидация

Система валидации поддерживает:
- Обязательные поля
- Проверка email
- Проверка телефона
- Минимальная/максимальная длина
- Пользовательские правила

## События

Основные события приложения:
- `catalog:loaded` - каталог загружен
- `basket:add` - товар добавлен в корзину
- `basket:remove` - товар удален из корзины
- `basket:clear` - корзина очищена
- `order:update` - обновление заказа
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна

## UI/UX особенности

### Модальные окна
- Открытие в видимой области страницы
- Закрытие по клику на оверлей
- Блокировка прокрутки страницы
- Плавные анимации

### Формы
- Валидация в реальном времени
- Отображение ошибок
- Активация кнопок при заполнении
- Белый цвет сообщений об ошибках

### Корзина
- Зеленый счетчик всегда видим
- Отображение "Корзина пуста" без маркера
- Неактивная кнопка "Оформить" при пустой корзине
- Автоматическая очистка после заказа

### Форматирование цен
- Пробелы для цен от 10 000
- Без пробелов для цен менее 10 000
- Единообразное отображение во всех местах

## Разработка

### Добавление новой команды

```typescript
class NewCommand extends Command<CommandData> {
  execute(): void {
    // Логика выполнения
  }
  
  undo(): void {
    // Логика отмены
  }
}
```

### Добавление валидатора

```typescript
const schema = {
  field: {
    required: true,
    minLength: 3,
    pattern: /^[a-zA-Z]+$/
  }
};
```

### Подписка на изменения состояния

```typescript
appStore.subscribe((state) => {
  // Реакция на изменение состояния
}, (state) => state.basket);
```

## Технические особенности

### Производительность
- Оптимизированные обновления UI
- Ленивая загрузка компонентов
- Эффективное управление памятью
- Минимальные перерисовки

### Безопасность
- Валидация всех пользовательских данных
- Санитизация HTML
- Защита от XSS
- Безопасная работа с DOM

### Надежность
- Обработка ошибок на всех уровнях
- Система уведомлений
- Логирование событий
- Graceful degradation

## Тестирование

Архитектура обеспечивает:
- Изолированное тестирование компонентов
- Мокирование зависимостей
- Тестирование команд
- Тестирование валидации

## UML-схемы

Подробные UML-схемы архитектуры находятся в файле [UML-схема-новая-архитектура.md](./UML-схема-новая-архитектура.md)

Схемы включают:
- **Диаграмму классов** - показывает структуру классов и интерфейсов
- **Диаграмму последовательности** - демонстрирует взаимодействие компонентов  
- **Диаграмму компонентов** - отображает архитектурные слои
- **Диаграмму состояний** - показывает жизненный цикл приложения
- **Диаграмму потоков данных** - отображает потоки данных в системе



